---
- name: Test de connectivité et services déployés
  hosts: all
  gather_facts: no
  tasks:
    - name: Vérifier la connexion SSH
      ping:

    - name: Vérifier que Docker est installé
      command: docker --version
      register: docker_version
      failed_when: docker_version.rc != 0

    - name: Vérifier que le container ic-webapp tourne
      community.docker.docker_compose_v2_info:
        project_src: /opt/ic-webapp
      register: compose_info

    - name: Assert que le service ic-webapp est UP
      assert:
        that:
          - "'ic-webapp' in compose_info.services"
          - compose_info.services['ic-webapp'].state == 'running'
        fail_msg: "Le container ic-webapp n'est pas en fonctionnement !"
